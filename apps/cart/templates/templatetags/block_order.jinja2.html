<table id="table_carts" cols="6" summary="Ваша корзина">
    <caption style="font-size:20px;">Ваша корзина</caption>
    <thead>
        <tr>
            <th scope="col" style="border-width:0px 0px 1px 0px;border-color:Black;border-style:solid;">Наименование</th>
            <th scope="col" style="width:95px;text-align:center;border-width:0px 1px 1px 1px;border-color:Black;border-style:solid;">Цена</th>
            <th scope="col" style="width:73px;text-align:center;border-width:0px 0px 1px 0px;border-color:Black;border-style:solid;">Кол-во</th>
            <th scope="col" style="width:110px;text-align:center;border-width:0px 1px 1px 1px;border-color:Black;border-style:solid;">Итого</th>
            <th scope="col" style="width:110px;text-align:center;border-width:0px 1px 1px 1px;border-color:Black;border-style:solid;">Сумма предоплаты</th>
            {# <th scope="col" style="text-align:center;">Под заказ</th> #}
            <th></th>
        </tr>
    </thead>
    <tbody>
<script>
var product_sum_of_quantity_in_order_array = new Array();
var product_sum_of_quantity_for_pay_array = new Array();

function CheckNumber(String){
	var Letters = ".,1234567890";
	var i;
	var c;
	for(i = 0; i < String.length; i ++){
		c = String.charAt( i );
		if (Letters.indexOf( c ) == -1){
			return true;
		}
	}
	return false;
}
</script>
            {% for product in cart.products %}
            {% set real_product=product.product %}
            <tr{% if real_product.check_product_availability()[0] != 1 %} class="lime"{% endif %}>
                <td>
                    <p{% if real_product.check_product_availability()[0] != 1 %} class="lime"{% endif %}>{{ real_product.title }}</p>
                </td>
                <td style="width:95px;text-align:center;border-width:0px 1px;border-color:Black;border-style:solid;"><p id="product_price_{{ product.pk }}">{{ real_product.get_price(request, None, 'show') }} {{ get_currency(request) }}</p></td>
                <td style="padding:0px;">
                    <p>{{ product.quantity }}</p>
                </td>
                <td style="width:110px;text-align:center;border-width:0px 1px;border-color:Black;border-style:solid;"><p id="sum_of_quantity_in_order_{{ product.pk }}">{{ product.sum_of_quantity(request, calc_or_show='show') }} {{ get_currency(request) }}</p></td>
                <td style="width:110px;text-align:center;border-width:0px 1px;border-color:Black;border-style:solid;"><p id="sum_of_quantity_for_pay_{{ product.pk }}">{{ product.sum_of_quantity(request, calc_or_show='calc') }} {{ get_currency(request) }}</p></td>
<script>
product_sum_of_quantity_in_order_array[{{ product.pk }}]={{ product.sum_of_quantity(request, calc_or_show='show') }};
product_sum_of_quantity_for_pay_array[{{ product.pk }}]={{ product.sum_of_quantity(request, calc_or_show='calc') }};
</script>
                <td>{{ real_product.check_product_availability(product_cart='order')[1]|safe }}</td>
            </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        {% if coupon %}<tr>
            <th colspan="3"
                style="text-align:right;">Купон с дисконтом {{ coupon.percentage_discount }}% - скидка:</th>
            <th colspan="1"
                id="all_sum_discount_in_order"
                style="text-align:center;color:Red;font-size:18px;border-width:0px 1px;border-color:Black;border-style:solid;"></th>
            <th colspan="1" style="border-width:0px 1px;border-color:Black;border-style:solid;"></th>
            <th colspan="1"></th>
        </tr>{% endif %}
        <tr>
            <th colspan="3"
                style="text-align:right;">Сумма заказа:</th>
            <th colspan="1"
                id="all_sum_of_quantity_in_order"
                style="text-align:center;color:Red;font-size:18px;border-width:0px 1px;border-color:Black;border-style:solid;"></th>
            <th colspan="1" style="border-width:0px 1px;border-color:Black;border-style:solid;"></th>
            <th colspan="1"></th>
        </tr>
        <tr>
            <th colspan="4"
                style="text-align:right;">Сумма предоплаты:</th>
            <th colspan="1"
                id="all_sum_of_quantity_for_pay"
                style="text-align:center;color:Red;font-size:18px;border-width:0px 1px;border-color:Black;border-style:solid;"></th>
            <th colspan="1"></th>
        </tr>
    </tfoot>
<script>
function ReCalcSum(){
    var sum_in_order=0;
	$.each(product_sum_of_quantity_in_order_array,function(i){
        var val=parseFloat(product_sum_of_quantity_in_order_array[i])
        if(0<=val&&val<=999999){
            sum_in_order+=val;
        }
    });
    var sum_for_pay=0;
	$.each(product_sum_of_quantity_for_pay_array,function(i){
        var val=parseFloat(product_sum_of_quantity_for_pay_array[i]);
        if(0<=val&&val<=999999){
            sum_for_pay+=val;
        }
    });
    {% if coupon %}
    var sum_discount_coupon = sum_in_order / 100 * {{ coupon.percentage_discount }};
    sum_in_order = sum_in_order - sum_discount_coupon;
    sum_for_pay = sum_for_pay - sum_for_pay / 100 * {{ coupon.percentage_discount }};
    if(typeof(sum_discount_coupon) != "undefined"){
        $("#all_sum_discount_in_order").html('-'+sum_discount_coupon.toFixed(2)+' <span class="Black">{{ get_currency(request) }}</span>');
    }{% endif %}
    $("#all_sum_of_quantity_in_order").html(sum_in_order.toFixed(2)+' <span class="Black">{{ get_currency(request) }}</span>');
    $("#all_sum_of_quantity_for_pay").html(sum_for_pay.toFixed(2)+' <span class="Black">{{ get_currency(request) }}</span>');
    if(parseInt(sum_in_order)<={{ 100 }}){
{# // similar behavior as an HTTP redirect
window.location.replace("http://stackoverflow.com");
// similar behavior as clicking on a link
window.location.href = "http://stackoverflow.com"; #}
        window.location.href = "/корзина/";}
}

$(document).ready(ReCalcSum(true));
</script>
</table>