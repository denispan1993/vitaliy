{% extends 'root.jinja2.html' %}
{# {% load header_category %} #}
{% block title %}Корзина{% if request.user %} пользователя - {{ request.user }}{% endif %}{% endblock %}
{% block content_center %}
    <div id="show_cart" style="color:Black;text-align:left;">
    {% if user_cart_ %}
        <form method="POST" action="/корзина/пересчитать/">
            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"/>
            <input type="hidden" name="POST_NAME" value="recalc_cart"/>
            <table id="table_carts" cols="6" summary="Ваша корзина">
                <caption style="font-size:20px;">Ваша корзина</caption>
                <thead>
                    <tr>
                        {# <th scope="col" class="center">Фото</td> #}
                        <th scope="col">Наименование</th>
                        {# <th scope="col">Цвет</th> #}
                        {# <th scope="col">Размер</th> #}
                        {# <th scope="col" class="center"><p>Цена за штуку</p></td> #}
                        <th scope="col" style="width:73px;text-align:center;">Кол-во</th>
                        <th scope="col" style="text-align:center;">Сумма</th>
                        {# <th scope="col" style="text-align:center;">Под заказ</th> #}
                        <th scope="col" style="text-align:center;">Удаление</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {# {% set products=user_cart_.products %} #}
<script>
function CheckNumber(String){
	var Letters = ".,1234567890";
	var i;
	var c;
	for(i = 0; i < String.length; i ++){
		c = String.charAt( i );
		if (Letters.indexOf( c ) == -1){
			return true;
		}
	}
	return false;
}
var product_summ_of_quantity_array = new Array();
product_summ_of_quantity_array[0]=0;
//product_summ_of_quantity_array[999999]=0;
</script>
{# {% set loop_style = 0 %} #}
                    {% for product in user_cart_.products %}
                    {% set real_product=product.product %}
{% include 'include/calc.script' %}
                        <tr{% if real_product.check_product_availability[0] != 1 %} class="lime"{% endif %}>
                            <td>
                                <input type="hidden"
                                       name="product_in_request_{{ product.pk }}"
                                       value="{{ product.pk }}"/>
{# {% if real_product.check_product_availability[0] != 1 and loop_style == 0 %}
{% set loop_style =+ 1 %}
<style>
table#table_carts tbody tr td a:active,
table#table_carts tbody tr td a:link,
table#table_carts tbody tr td a:hover,
table#table_carts tbody tr td a:visited{
color:Red;
}
</style>
{% endif %} #}
                                <a href="{{ real_product.get_absolute_url() }}"{% if real_product.check_product_availability[0] != 1 %} class="lime"{% endif %}>{{ real_product.title }}</a>
                            </td>
                            <td style="padding:0px;">
                                <li style="float:left;list-style-type:none;line-height:22px;">
                                    <a href="javascript:void(0)">
                                        <img src="/media/img/minus.gif"
                                            onClick="Calculate_{{ product.pk }}('-')">
                                    </a>
                                </li>
                                <li style="float:left;list-style-type:none;line-height:22px;">
                                    <input id="quantity1_{{ product.pk }}"
                                           style="border:1px solid #CCCCCC;text-align:center;width:25px;padding:2px;"
                                           name="quantity_{{ product.pk }}" value="{{ product.quantity }}"
        								   onKeyUp="onChange_{{ product.pk }}();"
                                           type="text">
                                </li>
                                <li style="float:left;list-style-type:none;line-height:22px;">
                                    <a href="javascript:void(0)">
                                        <img src="/media/img/plus.gif"
                                            onClick="Calculate_{{ product.pk }}('+')">
                                    </a>
                                </li>
                            </td>
                            {# {% set product_summ_of_quantity = product.summ_of_quantity %}
                            {% set real_product_price_of_quantity = real_product.price_of_quantity %}
                            {% set summ_of_quantity =  product_summ_of_quantity/real_product_price_of_quantity %} {{ summ_of_quantity }} #}
                            <td><p id="summ_of_quantity_{{ product.pk }}">{{ product.summ_of_quantity(request) }} {{ get_currency(request) }}</p></td>
<script>
product_summ_of_quantity_array[{{ product.pk }}]={{ product.summ_of_quantity(request) }};{# |replace(",", ".") #} {# |trim_whitespace #}
</script>
{#                             <td style="text-align:center;">
                                {% if real_product.is_availability == 3 %}
                                    <input type="checkbox" disabled checked>
                                {% else %}
                                    <input type="checkbox" disabled>
                                {% endif %}
                            </td> #}
                            <td style="text-align:center;">
                                <input id="delete1_{{ product.pk }}"
                                       name="delete_{{ product.pk }}"
                                       title="Для удаления товара, нажмите кнопку перечитать корзину."
                                       {# checked="" #}
                                       {# onchange="javascript:delete_on_off('delete1_{{ product.pk }}','delete2_{{ product.pk }}')" #}
                                       type="checkbox">
                            </td>
                            <td>{{ real_product.check_product_availability[1]|safe }}</td>
                        </tr>
                    {% endfor %}

{# <script>
function reselect_minus(IdString1, IdString2){
    var value = document.getElementById(IdString1).value
    if (value > 1 && value <= 999 ){
        document.getElementById(IdString1).value--;
        document.getElementById(IdString2).value--;
        ReCalcSumm();}
    return false;}
function reselect_plus(IdString1, IdString2){
    var value = document.getElementById(IdString1).value
    if (value >= 1 && value < 999 ){
        document.getElementById(IdString1).value++;
        document.getElementById(IdString2).value++;
        ReCalcSumm();}
    return false;} #}
<script>
function delete_on_off(IdString1, IdString2){
    var checked = document.getElementById(IdString1).checked
    document.getElementById(IdString2).checked = checked;
    return false;}
</script>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="2"
                            style="text-align:right;">Сумма:</th>
                        <th colspan="2"
                            id="all_summ_of_quantity"
                            style="text-align:left;color:Red;font-size:18px;"></th>
                    </tr>
                </tfoot>
            </table>
<style>
div#show_cart form p{
margin-bottom:10px;
}
</style>
            <p>Минимальная сумма заказа {{ 100|convert_currency(request) }} {{ get_currency(request) }}</p>
            <input style="float:left;list-style-type:none;line-height:24px;margin-right:5px;"
                   type="submit"
                   value="Пересчитать корзину"/>
        </form>
        <form method="POST" action="/корзина/заказ/">
            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"/>
            <input type="hidden" name="POST_NAME" value="order_cart"/>
            {% for product in user_cart_.products %}
                <input id="quantity2_{{ product.pk }}"
                       name="quantity_{{ product.pk }}" value="{{ product.quantity }}"
                       type="hidden"/>
                <input id="delete2_{{ product.pk }}"
                       name="delete_{{ product.pk }}"
                       {# checked="" #}
                       type="hidden"/>
            {% endfor %}
            <input style="float:left;list-style-type:none;line-height:24px;margin-right:5px;font-weight:bold;"
                   id="order_cart_input"
                   type="submit"
                   value="Оформить заказ"/>
            <a style="float:left;list-style-type:none;line-height:32px;margin-right:5px;"
               href="/"
               title="Вернуться к покупкам">Продолжить покупки &gt;&gt;</a>
        </form>
<script>
function ReCalcSumm(change){
    var summ=0;
	$.each(product_summ_of_quantity_array,function(i){
        var val=parseFloat(product_summ_of_quantity_array[i])
        if(0<=val&&val<=999999){
            summ+=val;
        }
    });
    if(change==true){$("#all_summ_of_quantity").html(summ.toFixed(2)+' {{ get_currency(request) }}');}
    if(parseInt(summ)<={{ 100|convert_currency(request) }}){$("#order_cart_input").prop("disabled",true);}
    else{$("#order_cart_input").prop("disabled",false);}
}
$(document).ready(ReCalcSumm(true));
</script>
    {% else %}
        <p>Ваша корзина пуста<br>
        <a href="/" title="Вернуться к покупкам">Продолжить покупки >></a></p>
    {% endif %}
    </div>
{% endblock %}
