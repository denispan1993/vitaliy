{% extends 'root.jinja2.html' %}
{% block title %}{{ product.meta_title|capfirst }}{% endblock %}
{% block description %}{{ product.meta_description }}{% endblock %}
{% block keywords %}{{ product.meta_keywords }}{% endblock %}
{% block product_header_css %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/category_style.css">
<link rel="stylesheet" href="{{ MEDIA_URL }}css/easypaginate/easypaginate.css" media="all">
{% endblock %}
{% set products_recommended = product.recomendate.all() %}
{% set length_products_recommended = products_recommended|length %} #}
{% set limit_products_recommended_on_string = request.session.limit_on_string %} #}
{% if products_recommended and length_products_recommended > limit_products_recommended_on_string %}
    {% block header_js %}
        <script src="{{ MEDIA_URL }}js/jquery/easypaginate/easypaginate.js"></script>
    {% endblock %}
{% endif %}
{% block body_javascript %}
{% endblock %}
{% block content_center %}
<style>
.clearFloat{
    clear:Both;
}
#product_box_left{
	float:left;
//	z-index:10;
	width:354px;
}
#product_box_left_top{
	margin:5px 5px 5px 0;
	text-align:center;
}
{# Вместо left_bottom -> slider
#product_box_left_bottom{
	margin-top:1px;
	text-align:center;
	height:55px;
}
#product_box_left_bottom ul{
//	width:45px;// height:45px;
//	margin-left:-15px;
//	float:left;
//	list-style-image:none;
//	list-style-type:none;
//	padding:0px;margin:2px;
	text-align:center;
}
#product_box_left_bottom ul li{
//	width:45px;// height:45px;
//	margin-left:-15px;
	float:left;
	list-style-image:none;
	list-style-type:none;
	padding:0px;margin:2px;
}
#product_box_left_bottom ul li img{
	width:45px;height:45px;
//	margin-left:-15px;
	float:left;
	list-style-image:none;
	list-style-type:none;
	padding:0px;margin:2px;
} #}
#product_box_right{
	width:300px;/*height:45px;*/
//	margin-left:-15px;
	float:left;
//	list-style-image:none;
//	list-style-type:none;
	padding:5px 0px 5px 0px;
//  margin:2px;

}
</style>
<div id="product_box" style="width:auto;height:auto;
                             border:5px solid #F2F2F2;
                             padding:5px;
                             color:#333333;
                             font-family:Arial,Helvetica,sans-serif;
                             font-size:12px;
                             line-height:125%;
                             min-height:380px;">
	<div id="product_box_header">
		{{ header_category2(current_category, product)|safe }}
	</div>
	<div id="product_box_top" style="width:100%;position:relative;" class="clearFloat">
		{# {% set photos = product.photo.all() %} #}
		<script src="/media/js/jquery/cloudzoom/cloudzoom_new.js"></script>
		<!-- Call quick start function. -->
		<script type="text/javascript">
			CloudZoom.quickStart();
		</script>
		<div id="product_box_left">
			<div id="product_box_left_top">
                {% set main_photo = product.main_photo %}
				{% if main_photo %}
					{# {% set photo_main = False %}
					{% for photo in photos if photo.main and not photo_main %} #}
						 <div style="text-align:center">
							 <div class="image-wrap">
								 {# <a href='{{ main_photo.photo.url }}' large image > #}
								 <img class="cloudzoom" id="zoom1"
									  src="{{ main_photo.photo.url_345x370 }}"{# small image #}
									  data-cloudzoom="
									  zoomImage:'{{ main_photo.photo.url }}',{# large image #}
									  zoomPosition:3,
									  zoomSizeMode:'image',
									  zoomOffsetX:15{# ,
									  zoomOffsetY:25 #}{# , #}
									  {# maxMagnification:4 #}"
									  alt="Cloud Zoom small image">
								 {# </a> #}
							 </div>
						 </div>
{#							 <a href='{{ main_photo.photo.url }}'
						   class = 'cloud-zoom'
						   id='zoom1'
						   rel="adjustX: 10, adjustY:-4">
							<img src="{{ main_photo.photo.url_345x370 }}"
								 alt=''
								 title="{{ main_photo.photo_sign }}"
								 id="img_productMainImg" />
						</a> #}
					{# 	{% set photo_main = photo %}
					{% endfor %} #}
				{% else %}
					<a title="{{ product.item_description }}"
					   id="a_productMainImg"
					   href="{{ product.get_absolute_url() }}">
						<img src="/media/img/NoPhoto_345x370.jpg"
							 title="Фотография продукта отсутсвует"
							 id="img_productMainImg" />
					</a>
				{% endif %}
			</div>
            {% set photos = product.all_photos %}
			{% if photos %}
				<script type="text/javascript">
				// Initialize the sliders.
				$(function(){
					$('#slider').Thumbelina({
						$bwdBut:$('#slider .left'),
						$fwdBut:$('#slider .right')
					});
				})
				</script>
				<script type="text/javascript" src="/media/js/jquery/thumbelina/thumbelina.js"></script>
				<div id="slider"
					 style="
						border-bottom:1px solid #AAAAAA;
						border-top:1px solid #AAAAAA;
						height:90px;
						margin-left:20px;
						margin-right:20px;
						position:relative;
						width:auto;">
					<style>
						.thumbelina-but.horiz.left {
							border-radius: 5px 0 0 5px;
							left: -22px;
						}
						.thumbelina-but.horiz {
							height: 90px;
							line-height: 98px;
							top: -1px;
							width: 20px;
						}
						.thumbelina-but {
							background-color: #CCCCCC;
							border: 1px solid #AAAAAA;
							box-shadow: 0 0 8px rgba(0, 0, 0, 0.25);
							color: #888888;
							cursor: pointer;
							font-family: monospace;
							font-size: 14px;
							font-weight: bold;
							position: absolute;
							text-align: center;
							vertical-align: middle;
							z-index: 1;
						}
						.thumbelina-but.disabled, .thumbelina-but.disabled:hover {
							background-color: #EFEFEF;
							box-shadow: none;
							color: #CCCCCC;
							cursor: default;
						}
					</style>
					<div class="thumbelina-but horiz left">˂</div>
						<div style="position:absolute;overflow:hidden;width:100%;height:100%;">
							<style>
								.thumbelina {
									font-size:0;
									list-style:none outside none;
									margin:0;
									padding:0;
									position:absolute;
									white-space:nowrap;
								}
							</style>
							<ul class="thumbelina" style="left: -180px;">
								<style>
									.thumbelina li img {
										border:1px solid #CCCCCC;
									}
									.thumbelina li img:hover {
										border:1px solid #AAAAAA;
									}
								</style>
								{% for photo in photos %}
									<li style="display:inline-block;">
										<img class="cloudzoom-gallery cloudzoom-gallery-active"
											 src="{{ photo.photo.url_90x95 }}" {# icon image #}
											 title='{{ photo.photo_sign }}'
											 data-cloudzoom="useZoom:'#zoom1',
											  image:'{{ photo.photo.url_345x370 }}',{# small image #}
											  zoomImage:'{{ photo.photo.url }}'">{# large image #}
									</li>
								{% endfor %}
							</ul>
						</div>
					<style>
						.thumbelina-but.horiz.right {
							border-radius:0 5px 5px 0;
							right:-22px;
						}
					</style>
					<div class="thumbelina-but horiz right">˃</div>
				</div>
				{# <div id="product_box_left_bottom">
					<ul>
						{% for photo in photos %}<!-- [1:] -->
							<li class="li_productMiniImg">
								<a href='{{ photo.photo.url }}'
								   class='cloud-zoom-gallery{% if photo == photo_main %} active{% endif %}'
								   title='{{ photo.photo_sign }}'
								   rel="useZoom: 'zoom1', smallImage: '{{ photo.photo.url_345x370 }}' ">
									<img src="{{ photo.photo.url_90x95 }}"
										 alt="{{ photo.photo_sign }}" />
								</a>
							</li>
<!--   							{1% if forloop.first %}
								<a class="zoomThumbActive" href="javascript:void(0);" title="{1{ photo.photo_sign }}" rel="{gallery: 'gal1', smallimage: '{1{ photo.photo.url_345x370 }}',largeimage: '{1{ photo.photo.url }}'}">
							{1% else %}
								<a href="javascript:void(0);" title="{1{ photo.photo_sign }}" rel="{gallery: 'gal1', smallimage: '{1{ photo.photo.url_345x370 }}',largeimage: '{1{ photo.photo.url }}'}">
							{1% endif %}
								<img src="{1{ photo.photo.url_90x95 }}" alt="{1{ photo.photo_sign }}" />
							</a>-->
						{% endfor %}
					</ul>
				</div> #}
			{% endif %}
		</div>
		<div id="product_box_right">
			<h1 style="font-size:16px;height:auto;line-height:20px;">
				<a href="{{ product.get_absolute_url() }}">
					{{ product.title|capfirst }}
				</a>
			</h1>
            {% set views = product.increase_View %}
            <p>Просмотров товара: {{ views.view_count }}</p>
			{# <h2 style="font-size:12px;font-weight:lighter;line-height:30px;">
				Наименование категории:
					<a href="{{ current_category.get_absolute_url() }}">
						{{ current_category.title|capfirst }}
					</a>
			</h2> #}
			<h3 style="font-size:12px;font-weight:lighter;line-height:30px;">
				Артикул товара: <span>{{ product.get_ItemID }}</span>
			</h3>
			{# <p>Текуший продукт: {{ product.name }}</p> #}
			{% if product.regular_price %}
				<p style="line-height:25px;margin:0px;padding:0px;color:#333333;font-family:Arial,Helvetica,sans-serif;font-size:12px;">
					Старая цена:
					<span style="text-decoration:line-through"> {{ product.regular_price|replace(",", ".") }} грн.</span>
				</p>
			{% endif %}
			<p class="dashed">{% if product.regular_price %}Акционная цена{% else %}Цена{% endif %}:
                <span class="productbox_right_pirce_red"> {{ product.price|replace(",", ".") }} грн. за {{ product.price_of_quantity }} {{ product.unit_of_measurement }}</span>
            </p>
<style>
p.price_total{
	margin:0;
	padding:6px 0px;
	text-indent:5px;
	color:#333333;
	font-family:Arial,Helvetica,sans-serif;
	font-size:12px;
	line-height:100%;
}
p.price_total span{
	color:#333333;
	text-indent:5px;
	font-family:Arial,Helvetica,sans-serif;
	font-size:12px;
	line-height:100%;
}
</style>
			<p class="pirce_total">
			<span id="cart_quant">{{ quantity_ }}</span>
			&nbsp;{{ product.unit_of_measurement }}&nbsp;×&nbsp;&nbsp;
			<span id="one_piece_price">{{ price_per_piece|replace(",", ".") }}</span>
			&nbsp;грн.&nbsp;=&nbsp;&nbsp;
			<span id="current_price">{{ sum_of_quantity|replace(",", ".") }}</span>
			&nbsp;грн.&nbsp;
			</p>
			{% set product_is_availability = product.is_availability %}
			{% if product.is_availability == 1 %}
<style>
.quantity{
	// margin:0px;
	list-style-type:none;
	padding: 0 0 0 5px;
}
.quantity li{
	line-height:22px;
	margin:0;
	list-style-type:none;
	float:left;
}
</style>
<script>
var price_qty_array = new Array();
var price_array = new Array();
price_qty_array[0]=1;
price_array[0]={{ product.price|replace(",", ".") }};
{#  {% if discount1 != None %}
		{% if discount1.price %}
			{% for discount in discounts %}
				<!--{1% if not forloop.first %}-->
				{% if forloop.last %}
price_qty_array[{{ forloop.counter }}]={{ discount.quantity_of_products }};
price_array[{{ forloop.counter }}]={{ discount.price|replace(",", ".") }};
price_qty_array[{{ forloop.counter|add:"1" }}]=999;
price_array[{{ forloop.counter|add:"1" }}]={{ discount.price|replace(",", ".") }};
				<!--{1% endif %}-->
				{% else %}
price_qty_array[{{ forloop.counter }}]={{ discount.quantity_of_products }};
price_array[{{ forloop.counter }}]={{ discount.price|replace(",", ".") }};
				{% endif %}
			{% endfor %}
		{% else %}
		{% endif %}
	{% else %} #}
price_qty_array[1]=999;
price_array[1]={{ product.price|replace(",", ".") }};
	{# {% endif %} #}
function checknumber(String){
	var Letters = ".,1234567890";
	var i;
	var c;
	for(i = 0; i < String.length; i ++){
		c = String.charAt( i );
		if (Letters.indexOf( c ) == -1){
			return true;
		}
	}
	return false;
}
function calculate(operation){
	//var price=0.00;
	//var total=0.00;
	var Qut=$("#quantity").val();
	//$("#quantity_order").val(Qut);
	$("#errorMsg").html('');
	if(checknumber(Qut)){
		//calculate();
		//alert('aaa'+Qut+'bbb');
		$("#errorMsg").html('Количество вводится цифрами!!!.');
		return false;
	}
	Qut=parseFloat(Qut);
	if(operation=='+'){Qut+={{ product.quantity_of_complete }}}
	if(operation=='-'){Qut-={{ product.quantity_of_complete }}}
	var minimal_quantity={{ product.minimal_quantity }}
	var quantity_of_complete={{ product.quantity_of_complete }};
	var intermediate_result=Qut-{{ product.minimal_quantity }};
	var result = intermediate_result%quantity_of_complete;
	//alert(result+' '+intermediate_result);
	if(result!=0&&intermediate_result!=0){
		$("#errorMsg").html('Количество едениц товара в заказе должно быть кратно '+quantity_of_complete+' !!!');
		result=Math.ceil(intermediate_result/quantity_of_complete);
		Qut=(result*quantity_of_complete)+minimal_quantity;
	}
	if(Qut<{{ product.minimal_quantity }}){
		//$("#quantity").val({{ product.minimal_quantity }});
		//$("#quantity_order").val({{ product.minimal_quantity }});
		//calculate();
		$("#errorMsg").html('Минимальное для заказа количество {{ product.minimal_quantity }} !!!');
		return false;
	}
	if(Qut>999){
		//$("#quantity").val(999);
		//$("#quantity_order").val(999);
		//calculate();
		$("#errorMsg").html('Количество не может быть больше 999!!!');
		return false;
	}
	$("#quantity").val(Qut);
	$("#quantity_order").val(Qut);
	$("#cart_quant").html(Qut);
	$.each(price_qty_array,function(i,val){
		if(val<=Qut&&Qut<price_qty_array[eval(i+1)]){
			//alert('i: '+i+' Qut: '+Qut+' val: '+val)
			var price=price_array[i]/{{ product.price_of_quantity }};
			$("#one_piece_price").html(price.toFixed(2));
			var total=price*Qut;
			$("#current_price").html(total.toFixed(2));
			return true;
		}
	});
}
function onChange(){
	window.setInterval("calculate('|')",5000);
	//setTimeout(calculate(value),1500);
	return true;
}
</script>
				<form method="POST" action=".">
					<ul class="quantity">
						<li>Количество:</li>
						<li>
							<a href="javascript:void(0)">
								<img src="/media/img/minus.gif"
									 onclick='calculate("-");'/>
							</a>
						</li>
						<li>
							<input id="quantity"
								   style="border:1px solid #CCCCCC;text-align:center;width:20px;padding:2px;"
								   name="quantity"
								   value="{{ quantity_ }}"
{#								 onchange="setTimeout('calculate()', 1500);" #}
								   onkeyup="onChange();"
								   type="number">
						</li>
						<li>
							<a href="javascript:void(0)">
								<img src="/media/img/plus.gif"
									onclick='calculate("+");'>
							</a>
						</li>
							<span id="errorMsg"
								  style="text-align:center;color:#FF0000">
							</span>
					</ul>
					<br class="clearFloat" />

					<input type="hidden" name="product_pk" value="{{ product.pk }}" />
					<input type="hidden" name="product_url" value="{{ product.url }}" />
					<input type="hidden" name="action" value="addtocard" />
					<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

					<input type="submit" value="Добавить в корзину" />
				</form>
<script>
$(document).ready(onChange())
</script>
				<br class="clearFloat" />
				<form method="POST" action=".">
					<input type="hidden" name="quantity" value="{{ quantity_ }}" id="quantity_order" />
					<input type="hidden" name="product_pk" value="{{ product.pk }}" />
					<input type="hidden" name="product_url" value="{{ product.url }}" />
					<input type="hidden" name="action" value="makeanorder" />
					<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

					<input type="submit" value="Купить" />
				</form>
			{% elif product.is_availability == 2 %}
				<p>Товар:&nbsp;<strong>ожидается</strong></p>
			{% elif product.is_availability == 3 %}
				<p>Товар:&nbsp;<strong>доступен под заказ</strong></p>
			{% elif product.is_availability == 4 %}
				<p>Товар:&nbsp;<strong>недоступен</strong></p>
			{% endif %}
		</div>
	</div>
    <div id="product_box_bottom"
            class="clearFloat"
            style="position:relative;">
        Краткое описание: {{ product.item_description }}
        Полное описание: {{ product.description }}
    </div>
</div>
{% if products_recommended %}
<div id="recommended_products"
     style="width:{% if limit_products_recommended_on_string == 4 %}976{% else %}732{% endif %}px;">
<p style="font-size:25px;color:Black;font-weight:bold;">Рекомендуемый товар</p>
{% if length_products_recommended > limit_products_recommended_on_string %}
<script>try{
$(document).ready(function($){
$('ul#products').easyPaginate({
    step:{{ limit_products_recommended_on_string }}, {# Defines a number of items visible on each "page". #}
    delay:500, {# Items on each "page" fade in one by one. This parameter controls the pause between each item’s appearance so we can create "wave" effect. It is defined in milliseconds. #}
    auto:false, {# Boolean. If set to true then the plugin will automatically rotate the "pages" #}
    pause:1000, {# If set to auto pagination, this parameter controls the length of the pause in milliseconds between each "page turn". #}
    clickstop:false {# If set to auto pagination, this parameter controls whether the pages will continue to automatically rotate. If you want to continue the rotation set this parameter to false. #}
});
});
}catch(e){ alert(e) }
</script>
<ul id="products">
    {% for product_recommended in products_recommended %}
        {{ block_product(product_recommended,'li')|safe }}
    {% endfor %}{#
  <li>Page 1</li>
  <li>Page 2</li>
  <li>Page 3</li>
  <li>Page 4</li>
  <li>Page 5</li>
  <li>Page 6</li>
  <li>Page 7</li>
  <li>Page 8</li>
 #}</ul>
</div>
{% else %}
<ul id="products">
    {% for product_recommended in products_recommended %}
        {{ block_product(product_recommended,'li')|safe }}
    {% endfor %}
</ul>
{% endif %}
{% endif %}
{% endblock %}
