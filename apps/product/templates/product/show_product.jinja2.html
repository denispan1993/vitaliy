{% extends 'root.jinja2.html' %}
{% block title %}{% if product.meta_title %}{{ product.meta_title|capfirst }}{% else %}{{ product.title|capfirst }}{% endif %}{% endblock %}
{% block description %}{{ product.meta_description }}{% endblock %}
{% block keywords %}{{ product.meta_keywords }}{% endblock %}
{% block product_header_css %}
{# <link rel="stylesheet" href="{{ MEDIA_URL }}css/category_style.css"> #}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/easypaginate/easypaginate.css" media="all">
{% endblock %}
{# {% set products_recommended = product.recomendate.all()%} #}
{# {% set products_recommended = product.recomendate.all()|custom_QuerySet_filter('is_availability', '=', 1) %} #}
{% set products_recommended = product.recomendation %}
{% set length_products_recommended = products_recommended|length %}{#  #}
{% set limit_products_recommended_on_string = request.session.limit_on_string %}{#  #}
{% if products_recommended and length_products_recommended > limit_products_recommended_on_string %}
{% block header_js %}
<script src="{{ MEDIA_URL }}js/jquery/easypaginate/easypaginate.js"></script>
{% endblock %}
{% endif %}
{% block header_javascript1 %}
<script src="{{ MEDIA_URL }}js/jquery/jquery-ui/jquery-ui-1.10.4.js"></script>
{% endblock %}
{% block body_javascript %}
{% endblock %}
{% block content_center %}
<style>
#product_box_left{
	float:left;
/*	z-index:10;*/
	width:354px;
}
#product_box_left_top{
	margin:5px 5px 5px 0;
/*	text-align:center;*/
}
{# Вместо left_bottom -> slider
#product_box_left_bottom{
	margin-top:1px;
	text-align:center;
	height:55px;
}
#product_box_left_bottom ul{
//	width:45px;// height:45px;
//	margin-left:-15px;
//	float:left;
//	list-style-image:none;
//	list-style-type:none;
//	padding:0px;margin:2px;
	text-align:center;
}
#product_box_left_bottom ul li{
//	width:45px;// height:45px;
//	margin-left:-15px;
	float:left;
	list-style-image:none;
	list-style-type:none;
	padding:0px;margin:2px;
}
#product_box_left_bottom ul li img{
	width:45px;height:45px;
//	margin-left:-15px;
	float:left;
	list-style-image:none;
	list-style-type:none;
	padding:0px;margin:2px;
} #}
</style>
<div id="product_box" style="width:98%;height:auto;
                             border:5px solid #FFF6C9;
                             border-radius:10px;
                             padding:5px;
                             color:#333333;
                             font-family:Arial,Helvetica,sans-serif;
                             font-size:12px;
                             line-height:125%;
                             display:inline-block;"
     itemscope itemtype="http://schema.org/Product">
	<div id="product_box_header" style="text-align:left;" class="clearFloat">
		{{ header_category2(current_category, product)|safe }}
	</div>
	<div id="product_box_top" style="width:100%;position:relative;" class="clearFloat">
		{# {% set photos = product.photo.all() %} #}
		<script src="/media/js/jquery/cloudzoom/cloudzoom_new.js"></script>
		<!-- Call quick start function. -->
		<script type="text/javascript">
			CloudZoom.quickStart();
		</script>
		<div id="product_box_left">
			<div id="product_box_left_top">
                {% set main_photo = product.main_photo %}
				{% if main_photo %}
                    <div class="image-wrap" style="height:372px;line-height:370px;">
                        <img class='cloudzoom'
                              style='vertical-align:middle;'
                              id='zoom1'
                              src='{{ main_photo.photo.url_345x370 }}' {# small image #}
                             data-cloudzoom="
                             zoomImage:'{{ main_photo.photo.url }}',{# large image #}
                             zoomPosition:3,
                             zoomSizeMode:'image',
                             zoomOffsetX:15{# ,
                             zoomOffsetY:25 #}{# , #}
                             {# maxMagnification:4 #}"
                             alt='{{ main_photo.title }}'
                             itemprop='image' />
                     </div>
				{% else %}
					<a title="{{ product.item_description }}"
					   id="a_productMainImg"
					   href="{{ product.get_absolute_url() }}">
						<img src="/media/img/NoPhoto_345x370.jpg"
							 title="Фотография продукта отсутсвует"
							 id="img_productMainImg" />
					</a>
				{% endif %}
                {% set photos = product.all_photos %}
    			{% if photos %}
                    <div id="slider">
                        {% set count_photos = photos|length %}
                        {% if count_photos > 3 %}
                            <script type="text/javascript">
                            // Initialize the sliders.
                            $(function(){
                                $('#slider').Thumbelina({
                                    $bwdBut:$('#slider .left'),
                                    $fwdBut:$('#slider .right')
                                });
                            })
                            </script>
                            <script type="text/javascript" src="/media/js/jquery/thumbelina/thumbelina.js"></script>
                            <div class="thumbelina-but horiz left">˂</div>
                        {% endif %}
                        <div id="parent">
                            <ul class="thumbelina"{% if count_photos > 3 %} style="left:-180px;"{% else %} style="position:relative;"{% endif %}>
                                {% for photo in photos %}
                                    <li style="display:inline-block;">
                                        <img class="cloudzoom-gallery cloudzoom-gallery-active"
                                             {% if loop.index > 1 %}style="margin-left:4px;"{% endif %}
                                             src="{{ photo.photo.url_90x95 }}" {# icon image #}
                                             title='{{ photo.photo_sign }}'
                                             data-cloudzoom="useZoom:'#zoom1',
                                              image:'{{ photo.photo.url_345x370 }}',{# small image #}
                                              zoomImage:'{{ photo.photo.url }}'">{# large image #}
                                    </li>
                                {% endfor %}
                            </ul>
                            <div id="helper"></div>
                        </div>
                        {% if count_photos > 3 %}
                            <div class="thumbelina-but horiz right">˃</div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
		<div id="product_box_right">
			<h1 itemprop="name">
				<a href="{{ product.get_absolute_url() }}"
                   title="{{ product.title|capfirst }}">
					{{ product.name|capfirst }}
				</a>
			</h1>
			<h3>
				Артикул товара: <span itemprop="productID">{{ product.get_ItemID }}</span>
			</h3>
            {% set manufacturer = product.get_manufacturer %}
            {% if manufacturer %}
                <p id="product_box_right_manufacturer">
                    Производитель: <span itemprop="brand">{{ manufacturer }}</span>
                </p>
            {% endif %}
			{% if product.regular_price %}
				<p id="product_box_right_regular_price">
					Старая цена:
					<span> {{ product.get_price(request, product.regular_price)|replace(",", ".") }} {{ get_currency(request) }}</span>
				</p>
			{% endif %}
			<p id="product_box_right_price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">{% if product.regular_price %}Акционная цена{% else %}Цена{% endif %}:
                <span class="{% if product.is_availability == 1 %}red{% else %}gray{% endif %}" itemprop="price"> {{ product.get_price(request)|replace(",", ".") }} {{ get_currency(request) }}{% if product.price_of_quantity != 1 %} за {{ product.price_of_quantity }} {{ product.unit_of_measurement }}{% endif %}</span>
            </p>
            {% if product.is_availability == 1 or product.is_availability == 3 %}
                <p class="price_total">
                    <span id="cart_quant">{{ quantity_ }}</span>{{ product.unit_of_measurement }}&nbsp;×&nbsp;
                    <span id="one_piece_price">{# {{ price_per_piece|replace(",", ".") }} #}</span>
                    &nbsp;{{ get_currency(request) }}&nbsp;=&nbsp;{# &nbsp; #}
                    <span id="current_price">{# {{ sum_of_quantity|replace(",", ".") }} #}</span>
                    &nbsp;{{ get_currency(request) }}{# &nbsp; #}
                </p>
            {% endif %}
            {% if product.is_availability == 1 or product.is_availability == 3 %}
                <style>
                .quantity{
                {# 	// margin:0px; #}
                    list-style-type:none;
                    font-size:15px;
                {# 	padding:0 0 0 5px; #}
                }
                .quantity li{
                    line-height:22px;
                    margin:0;
                    list-style-type:none;
                    float:left;
                    font-size:18px;
                }
                </style>
{% include 'product/include/calc.script' %}
				<form method="POST" action="." style="padding-top:15px;">
					<ul class="quantity">
						<li>Количество:</li>
						<li>
							<a href="javascript:void(0)">
								<img src="/media/img/minus.gif"
									 onclick='calculate("-");'/>
							</a>
						</li>
						<li>
{# <style>
input[type='number']{
-moz-appearance:textfield;
}
input::-webkit-outer-spin-button{
-webkit-appearance:none;
margin:0;
}
</style> #}
							<input id="quantity"
								   style="border:1px solid #CCCCCC;text-align:center;width:20px;padding:2px;overflow:hidden;height:100%;-moz-appearance:textfield;-webkit-appearance:textfield;"
								   name="quantity"
                                   min="{{ product.minimal_quantity }}"
                                   max="999"
                                   step="{{ product.quantity_of_complete }}"
								   value="{{ quantity_ }}"
{#								 onchange="setTimeout('calculate()', 1500);" #}
								   onkeyup="onChange();"
								   type="number">
						</li>
						<li>
							<a href="javascript:void(0)">
								<img src="/media/img/plus.gif"
									onclick='calculate("+");'>
							</a>
						</li>
							<span id="errorMsg"
								  style="text-align:center;color:#FF0000">
							</span>
					</ul>
{# 					<br class="clearFloat" /> #}

					<input type="hidden" name="product_pk" value="{{ product.pk }}" />
					<input type="hidden" name="product_url" value="{{ product.url }}" />
					<input type="hidden" name="action" value="addtocard" />
					<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

					<input type="submit" value="Добавить в корзину" style="margin-top:2px;">
				</form>
<script>
$(document).ready(onChange())
</script>
{#              <br class="clearFloat" /> #}
				<form method="POST" action=".">
					<input type="hidden" name="quantity" value="{{ quantity_ }}" id="quantity_order" />
					<input type="hidden" name="product_pk" value="{{ product.pk }}" />
					<input type="hidden" name="product_url" value="{{ product.url }}" />
					<input type="hidden" name="action" value="makeanorder" />
					<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

					<input type="submit" value="Купить" />
				</form>
            {% endif %}
			{% if product.is_availability == 2 %}
				<p>Товар:&nbsp;<strong>ожидается</strong></p>
			{% elif product.is_availability == 3 %}
				<p>Товар:&nbsp;<strong>доступен под заказ</strong><br>В случае покупки товара под заказ, взымается предоплата 50% от стоимости заказаного товара.<br>Доставка от 1-й до 4-х недель.</p>
			{% elif product.is_availability == 4 %}
				<p>Товар:&nbsp;<strong>недоступен</strong></p>
			{% endif %}
            <div id="product_box_bottom"
{#                     class="clearFloat" #}
                    style="position:relative;font-size:15px;color:Black;text-align:justify;line-height:20px;padding:7px 5px 5px 0px;letter-spacing:1px;"
                    itemprop="description">
                {{ product.description|safe }}
            </div>
{% if user.is_authenticated and user.is_staff %}
<style>
#product_box_bottom_comment{
    float:left;
    clear:both;
}
</style>
            <div id="product_box_bottom_comment">
<script>
function open_window_comment_add(){
var param = 'width=500,height=400,menubar=no,toolbar=no,location=no,directories=no,status=no,resizable=no,scrollbars=no'
var newWin = window.open('{{ product.get_absolute_url() }}комментарий/добавить/', 'Comment_add', param);

newWin.focus();
newWin.onload = function() {

  // создать div в документе нового окна
  var div = newWin.document.createElement('div');
  div.innerHTML = 'Добро пожаловать!'
  div.style.fontSize = '30px'


  var body = newWin.document.body;

  // вставить первым элементом в новое body
  body.insertBefore(div, body.firstChild);
}
}
</script>
                {% for comment in product.comments.all() %}
                    <p>{{ loop.index }}. Имя:{{ comment.name }}</p>
                    <p>{{ loop.index }}. Комментарий:{{ comment.comment }}</p>
                {% endfor %}
                <input type="button"
                       value="Оставить комментарий-отзыв на товар, задать вопрос о товаре."
                       onclick="javascript:open_window_comment_add();">
            </div>
{% endif %}
		</div>
    </div>
</div>
{% if length_products_recommended > limit_products_recommended_on_string %}
<script>try{
$(document).ready(function($){
$('ul#products').easyPaginate({
    step:{{ limit_products_recommended_on_string }}, {# Defines a number of items visible on each "page". #}
    delay:500, {# Items on each "page" fade in one by one. This parameter controls the pause between each item’s appearance so we can create "wave" effect. It is defined in milliseconds. #}
    auto:false, {# Boolean. If set to true then the plugin will automatically rotate the "pages" #}
    pause:1000, {# If set to auto pagination, this parameter controls the length of the pause in milliseconds between each "page turn". #}
    clickstop:false {# If set to auto pagination, this parameter controls whether the pages will continue to automatically rotate. If you want to continue the rotation set this parameter to false. #}
});
});
}catch(e){ alert(e) }
</script>
{% endif %}
{% if products_recommended %}
<div id="recommended_products"
     style="width:{{ request.session.width_main_center }}px;">
<p style="font-size:25px;color:Black;font-weight:bold;">Рекомендуемый товар</p>
<ul id="products">
    {% for product_recommended in products_recommended %}
        {{ one_block(product_recommended, request, 'li', 0, False, 'product')|safe }}
    {% endfor %}
</ul>
</div>
{% endif %}
{% endblock %}
{# {1% block content_right %}
    <p>Очень правая колонка</p>
    {{ viewed_ }}
{% endblock %} #}